<!DOCTYPE html>
<html lang="tr" ng-app="myAngularJSApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AngularJS Component App</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            padding: 20px;
        }

        .suggestion-card {
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .suggestion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card-img-top-container {
            height: 200px;
            background-size: cover;
            background-position: center;
        }

        .location-preview {
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }

        .location-preview:hover {
            background-color: #e2e6ea !important;
            /* Bootstrap'in rengini ezmek için */
        }
    </style>

</head>

<body>

    <!-- Ana Kontrolcümüz (Parent) tüm bu alanı yönetir -->
    <div class="container" ng-controller="MainController as vm">
        <h1 class="mb-4">Hava Durumu ve Şehir Görseli</h1>
        <div class="location-preview alert alert-light" ng-if="vm.locationPreview"
            ng-click="vm.displayCity(vm.locationPreview)" title="Detayları görmek için tıklayın">

            <i class="fas fa-map-marker-alt"></i> <!-- İkon -->
            <strong>{{ vm.locationPreview.weatherData.cityName }}</strong>, {{ vm.locationPreview.weatherData.temp.c }}°C / {{ vm.locationPreview.weatherData.temp.f }}°F

        </div>


        <!-- Arama Formu-->
        <form name="weatherForm" ng-submit="weatherForm.$valid && vm.getWeather()" novalidate>
            <div class="form-group">
                <label for="cityInput">Şehir Adı Girin</label>
                <input type="text" id="cityInput" name="cityInput" class="form-control" ng-model="vm.city"
                    placeholder="Örn: İstanbul" required>
            </div>
            <button type="submit" class="btn btn-primary" ng-disabled="!vm.isReady">
                {{vm.isReady ? 'Bilgileri Getir ' : 'Yükleniyor... '}}
            </button>
        </form>

        <div ng-if="vm.loadingPopular" class="text-center mt-4">
            <p>Öneriler yükleniyor...</p>
        </div>

        <!-- Ana 'row' div'i, popüler şehirler varsa görünür -->
        <div class="row mt-4" ng-if="!vm.loadingPopular && vm.popularCities.length > 0">
            <div class="col-12">
                <h4>Önerilen Şehirler</h4>
            </div>

            <!-- ng-repeat ile popüler şehirler dizisindeki her bir şehir için bir kart oluştur -->
            <div class="col-md-4 mb-3" ng-repeat="cityData in vm.popularCities">
                <!-- Karta tıklandığında, ana sonuç bölümünü bu kartın verisiyle doldur -->
                <div class="card suggestion-card" ng-click="vm.displayCity(cityData)">

                    <!-- Resim bulunamazsa varsayılan bir arkaplan göster -->
                    <div class="card-img-top-container"
                        ng-style="{'background-image': 'url(' + (cityData.imageData.imageUrl || 'https://via.placeholder.com/400x250?text=Resim+Yok') + ')'}">
                    </div>

                    <div class="card-body">
                        <h5 class="card-title">{{ cityData.weatherData.cityName }}</h5>
                        <p class="card-text">
                            <i class="fas fa-thermometer-half"></i>
                            {{ cityData.weatherData.temp.c }}°C / {{ cityData.weatherData.temp.f }}°F, {{
                            cityData.weatherData.description }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <hr>

        <!-- Yükleniyor ve Hata Mesajları -->
        <div ng-show="vm.loading" class="alert alert-info">
            Veriler yükleniyor, lütfen bekleyin...
        </div>
        <div ng-show="weatherForm.cityInput.$dirty && weatherForm.cityInput.$error.required" class="alert alert-danger">
            Lütfen bir şehir adı giriniz.
        </div>
        <div ng-show="vm.error" class="alert alert-danger">
            {{ vm.error }}
        </div>

        <!-- Bu ana div, sadece sonuçlar başarılı bir şekilde geldiğinde görünür -->
        <div ng-if="vm.result && !vm.error">

            <weather-display weather-info="vm.result.weatherData"></weather-display>
            <image-display image-info="vm.result.imageData"></image-display>
            <chart-display weather-info="vm.result.weatherData"></chart-display>
            <map-display weather-info="vm.result.weatherData"></map-display>

        </div>

    </div>

    <!-- Script dosyaları -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/angular-chart.js@1.1.1/dist/angular-chart.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/angular-leaflet-directive@0.10.0/dist/angular-leaflet-directive.min.js"></script>
    <script src="app.js"></script>
</body>

</html>